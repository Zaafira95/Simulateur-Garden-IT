<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>HTML TO PDF</title>
	<script src="js/jquery.min.js"></script>
  <script src="taux-impot.js"></script>
  <link href="https://netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <link href="css/style.css" rel="stylesheet" >
</head>
<body>


  <form id="wf-form-Simu" name="wf-form-Simu" data-name="Simu">
            
    <div class="formulaire">

        <img src="logoGardenIT.png" class="logo"> <br>

        <label >Nom Prénom</label>
        <div> <input type="text" value="NOM Prénom"
                maxlength="256" data-name="" placeholder="" id="nom-prenom" required=""> </div><br>

        <label >Taux Garden IT</label>
        <div> <input type="number" value="0.59"
                maxlength="256" data-name="" placeholder="" id="taux-garden-it"> </div><br>

        <label >Taux EUR/CHF</label>
        <div> <input type="number" value="1.03"
                maxlength="256" data-name="" placeholder="" id="taux-eur-chf"> </div><br>

        <label >Catégorie</label>
        <div><select id="categorie">
          <option value="A0">A0</option>
          <option value="B0">B0</option>
          <option value="B1">B1</option>
          <option value="B2">B2</option>
          <option value="B3">B3</option>
          <option value="B4">B4</option>
          <option value="B5">B5</option>
          <option value="C0">C0</option>
          <option value="C1">C1</option>
          <option value="C2">C2</option>
          <option value="C3">C3</option>
          <option value="C4">C4</option>
          <option value="C5">C5</option>
          <option value="H0">H0</option>
          <option value="H1">H1</option>
          <option value="H2">H2</option>
          <option value="H3">H3</option>
          <option value="H4">H4</option>
          <option value="H5">H5</option>
        </select><br><br></div>


        <label >Age</label>
        <div> <input type="number" value="38"
                maxlength="256" data-name="" placeholder="" id="age"> </div><br>

        <label >TJM</label>
        <div> <input type="number" value="588"
                maxlength="256" data-name="" placeholder="" id="tjm"> </div><br>

        <label >Jours travaillés</label>
        <div> <input type="number" value="20"
                maxlength="256" data-name="" placeholder="" id="nbJours"> </div><br>

        <label >Distance Domicile / Travail (A/R en km)</label>
        <div> <input type="number" value="60"
                maxlength="256" data-name="" placeholder="" id="distance"> </div><br>
               
        <button type="button" onclick="afficher();" id="btn2">Simuler</button>
      </div>
</form>

<div id="invoice" style="display: none;">
  <button> <a  href="javascript:void(0)" class="btn-download">Télécharger le PDF  </a></button>
  <button><a  href="javascript:void(0)" class="btn-download-2">Informations du consultant  </a></button>
  <div id="pdf">
    <div>
      <h3 id="nom-prenom-aff">NOM PRENOM</h3>
      <h3>TJM : <span id="tjm-aff"></span> €</h3>
      <h3><span>SIMULATION SUR 20J</span></h3>
    </div>
    <article>
           <br><br>     
      <table class="inventory">
        <thead>
          <tr>
            <th><span >DESCRIPTION DE L'ARTICLE</span></th>
            <th><span >CHF</span></th>
            <th><span >EUR</span></th>
          </tr>
        </thead>
        <tbody>
        <tr>
            <td>Chiffres d'affaires</td>
            <td class="separation"  ><span id="ca-chf"></span></td>
            <td style="font-weight: bold;" ><span id="ca-eur"></span></td>
        </tr>
        <tr>
            <td>Salaire brut</td>
            <td class="separation"  ><span id="salaire-brut-chf"></span></td>
            <td style="font-weight: bold;" ><span id="salaire-brut-eur"></span></td>
        </tr>
        <tr>
            <td>Frais (panier repas + IK)</td>
            <td class="separation"  ><span id="frais-repas-chf"></span></td>
            <td style="font-weight: bold;" ><span id="frais-repas-eur"></span></td>
        </tr>
        <tr>
            <td>Impôts (catégorie d'imposition : <span id="categorie">test</span> )</td>
            <td class="separation"  ><span id="impot-chf"></span></td>
            <td style="font-weight: bold;" ><span id="impot-eur"></span></td>
        </tr>
        <tr>
            <td>Salaire net d'impôts</td>
            <td class="separation" style="font-size: 150%;" ><span id="salaire-net-chf"></span></td>
            <td style="font-weight: bold; font-size: 150%;" ><span id="salaire-net-eur"></span></td>
        </tr>
        <tr>
            <td class="ratio" style="font-weight: bold;">RATIO CA / SALAIRE</td>
            <td class="ratio" colspan="2" style="font-weight: bold; font-size: 200%;"><span id="ratio"></span></td>
        </tr>
        </tbody>
      </table>

      <div>
        <p>Votre fiche de paie sera éditée en CHF, mais vous percevrez votre salaire en Euro.</p>
        <p>Vous serez payé à récepton du paiement client ( à 30J en général ).</p>
        <p>Votre fiche de paie sera calculée par rapport au chiffre d'affaires que vous générez. Cette simulation est faite sur 20J.</p>
        <p>Concernant le choix de la côtisation pour la sécurité sociale : </p>
        <p>&ensp; • Il faut compter environ 200 pour la sécurité sociale suisse <strong>LAMAL </strong> si vous optez pour celle-ci.</p>
        <p>&ensp; • Si vous choisissez la <strong>CMU, </strong> votre côtisation mensuelle sera calculée par rapport à votre salaire brut A-2</p>
        <p><br>*Taux de change EUR/CHF : <span id="taux-eur-chf-aff">test</span></p>
      </div>
    </article>
    <aside>
      <div style="text-align: center;">
        <p>Garden IT Sàrl  
          <br>Rue du Général Dufour, 20 1204 Genève</p>
        <p></p>
      </div>
    </aside>
  </div>
</div>

<div id="invoice2" style="display: none;">
  <div id="pdf2">
    <div>
      <h3>Simulation de <span id="nom-prenom-aff-2"></span></h3>
    </div>
    <article>
           <br><br>     
      <table class="inventory2">
        <tbody>
        <tr>
            <td>Age</td>
            <td style="font-weight: bold;; font-size: 130%;" ><span id="age-aff"></span></td>
        </tr>
        <tr>
            <td>TJM</td>
            <td style="font-weight: bold;; font-size: 130%;" ><span id="tjm-aff-2"></span> €</td>
        </tr>
        <tr>
            <td>Jours travaillés</td>
            <td style="font-weight: bold;; font-size: 130%;" ><span id="nb-jours-aff"></span></td>
        </tr>
        <tr>
            <td>Distance Domicile/Travail (A/R en km)</td>
            <td style="font-weight: bold;; font-size: 130%;" ><span id="distance-aff"></span> km</td>
        </tr>
        <tr>
            <td>Catégorie</td>
            <td style="font-weight: bold; font-size: 130%;" ><span id="categorie-aff-2"></span></td>
        </tr>
        <tr>
          <td>Taux Garden IT</td>
          <td style="font-weight: bold; font-size: 130%;" ><span id="taux-garden-aff"></span></td>
        </tr>
        <tr>
          <td>Taux EUR / CHF</td>
          <td style="font-weight: bold; font-size: 130%;" ><span id="taux-eur-chf-aff-2"></span></td>
        </tr>
        </tbody>
      </table>

    </article>
    <aside>
      <div style="text-align: center;">
        <p>Garden IT Sàrl  
          <br>Rue du Général Dufour, 20 1204 Genève</p>
        <p></p>
      </div>
    </aside>
  </div>
</div>


<script src="js/jspdf.debug.js"></script>
<script src="js/html2canvas.min.js"></script>
<script src="js/html2pdf.min.js"></script>


<script>

    const options = {
      margin: 0.5,
      filename: 'invoice.pdf',
      image: { 
        type: 'svg', 
        quality: 500
      },
      html2canvas: { 
        scale: 1 
      },
      jsPDF: { 
        unit: 'in', 
        format: 'letter', 
        orientation: 'portrait' 
      }
    }
    
    $('.btn-download').click(function(e){
      e.preventDefault();
      const element = document.getElementById('pdf');
      html2pdf().from(element).set(options).save();
    });

    $('.btn-download-2').click(function(e){
      e.preventDefault();
      const element = document.getElementById('pdf2');
      html2pdf().from(element).set(options).save();
    });


    function printDiv(divName) {
     var printContents = document.getElementById(divName).innerHTML;
     var originalContents = document.body.innerHTML;

     document.body.innerHTML = printContents;

     window.print();

     document.body.innerHTML = originalContents;
}
    </script>

<script>

  function afficher(){
      let nomPrenom = document.getElementById('nom-prenom').value;
      let tauxGardenIT = document.getElementById('taux-garden-it').value;
      let tauxEurChf = document.getElementById('taux-eur-chf').value;
      let categorie = document.getElementById('categorie').value;
      let age = document.getElementById('age').value;
      let tjmEUR = document.getElementById('tjm').value;
      let nbJours = document.getElementById('nbJours').value;
      let distance = document.getElementById('distance').value;

      let nbJoursInf = Math.floor(nbJours);
      let nbJoursSup = Math.ceil(nbJours);
      let tauxChfEur = 0.9765;
      let nbHeures = nbJours * 8;

      let tjmCHF = tjmEUR * tauxEurChf;
      let caEUR = tjmEUR * nbJours;
      let caEURArr = caEUR.toFixed(2);
      let caCHF= caEUR * tauxEurChf;
      let caCHFArr = caCHF.toFixed(2);
      let tjmConsCHF = tauxGardenIT * tjmCHF;
      let tjmConsCHFArr = tjmConsCHF.toFixed(2);
      let tjmConsEUR = tjmConsCHF/tauxEurChf;
      let tjmConsEURArr = tjmConsEUR.toFixed(2);
      let salaireJourCHF = tjmConsCHF * nbJours;
      let salaireJourCHFArr = salaireJourCHF.toFixed(2);
      let salaireJourEUR = salaireJourCHF/tauxEurChf;
      let salaireJourEURArr = salaireJourEUR.toFixed(2);
      let salaireHorCHF = tjmConsCHF/8;
      let salaireHorCHFArr = salaireHorCHF.toFixed(2);
      let salaireHorEUR = salaireHorCHF/tauxEurChf;
      let salaireHorEURArr = salaireHorEUR.toFixed(2);
      let vacCHF = 0.083333 * salaireJourCHF;
      let vacCHFArr = vacCHF.toFixed(2);
      let vacEUR = vacCHF/tauxEurChf;
      let vacEURArr = vacEUR.toFixed(2);
      let primeCHF = 0; //???
      let primeEUR = 0; //???
      let salaireBrutCHF = salaireJourCHF + vacCHF + primeCHF;
      let salaireBrutCHFArr = salaireBrutCHF.toFixed(2);
      let salaireBrutEUR = salaireBrutCHF/tauxEurChf;
      let salaireBrutEURArr = salaireBrutEUR.toFixed(2);

      let tauxImpot = searchTauxImpot(salaireBrutCHF, categorie)/100;

      let cotAvsCHF = salaireBrutCHF * 0.053;
      let cotAvsCHFArr = cotAvsCHF.toFixed(2);
      let cotAvsEUR = cotAvsCHF/tauxEurChf;
      let cotAvsEURArr = cotAvsEUR.toFixed(2);
      let cotAcCHF = salaireBrutCHF * 0.011;
      let cotAcCHFArr = cotAcCHF.toFixed(2);
      let cotAcEUR = cotAcCHF/tauxEurChf;
      let cotAcEURArr = cotAcEUR.toFixed(2);
      let cotMaterniteCHF = 0.00046 * salaireBrutCHF;
      let cotMaterniteCHFArr = cotMaterniteCHF.toFixed(2);
      let cotMaterniteEUR = cotMaterniteCHF/tauxEurChf;
      let cotMaterniteEURArr = cotMaterniteEUR.toFixed(2);
      let cotLaaCHF = 0.01111 * salaireBrutCHF;
      let cotLaaCHFArr = cotLaaCHF.toFixed(2);
      let cotLaaEUR = cotLaaCHF/tauxEurChf;
      let cotLaaEURArr = cotLaaEUR.toFixed(2);
      let cotIjmCHF = 0.00321 * salaireBrutCHF;
      let cotIjmCHFArr = cotIjmCHF.toFixed(2);
      let cotIjmEUR = cotIjmCHF/tauxEurChf;
      let cotIjmEURArr = cotIjmEUR.toFixed(2);
      let retImpotCHF = salaireBrutCHF * tauxImpot;
      let retImpotCHFArr = retImpotCHF.toFixed(2);
      let retImpotEUR = retImpotCHF/tauxEurChf;
      let retImpotEURArr = retImpotEUR.toFixed(2);
      let totalChargeCHF = cotAvsCHF + cotAcCHF + cotMaterniteCHF + cotLaaCHF + cotIjmCHF + retImpotCHF;
      let totalChargeCHFArr = totalChargeCHF.toFixed(2);
      let totalChargeEUR = totalChargeCHF/tauxEurChf;
      let totalChargeEURArr = totalChargeEUR.toFixed(2);
      let fraisVoitCHF = distance * nbJoursSup * 0.7;
      let fraisVoitCHFArr = fraisVoitCHF.toFixed(2);
      let fraisVoitEUR = fraisVoitCHF/tauxEurChf;
      let fraisVoitEURArr = fraisVoitEUR.toFixed(2);
      let fraisRepasCHF = 30 * nbJoursInf;
      let fraisRepasCHFArr = fraisRepasCHF.toFixed(2);
      let fraisRepasEUR = fraisRepasCHF/tauxEurChf;
      let fraisRepasEURArr = fraisRepasEUR.toFixed(2);
      let notesFraisCHF = 0; //???
      let notesFraisEUR = 0; //???
      let totalFraisCHF = fraisVoitCHF + fraisRepasCHF;
      let totalFraisCHFArr = totalFraisCHF.toFixed(2);
      let totalFraisEUR = totalFraisCHF/tauxEurChf;
      let totalFraisEURArr = totalFraisEUR.toFixed(2);
      let salaireTotalCHF = salaireBrutCHF - totalChargeCHF + notesFraisCHF + totalFraisCHF;
      let salaireTotalCHFArr = salaireTotalCHF.toFixed(2);
      let salaireTotalEUR = salaireTotalCHF * tauxChfEur;
      let salaireTotalEURArr = salaireTotalEUR.toFixed(2);
      let cotAapCHF = 0.00063 * salaireBrutCHF;
      let cotAapCHFArr = cotAapCHF.toFixed(2);
      let cotAapEUR = cotAapCHF/tauxEurChf;
      let cotAapEURArr = cotAapEUR.toFixed(2);
      let cotLaacCHF = 0.00168 * salaireBrutCHF;
      let cotLaacCHFArr = cotLaacCHF.toFixed(2);
      let cotLaacEUR = cotLaacCHF/tauxEurChf;
      let cotLaacEURArr = cotLaacEUR.toFixed(2);
      let contribEnfCHF = 0.0007 * salaireBrutCHF;
      let contribEnfCHFArr = contribEnfCHF.toFixed(2);
      let contribEnfEUR = contribEnfCHF/tauxEurChf;
      let contribEnfEURArr = contribEnfEUR.toFixed(2);
      let contribAllocCHF = 0.024 * salaireBrutCHF;
      let contribAllocCHFArr = contribAllocCHF.toFixed(2);
      let contribAllocEUR = contribAllocCHF/tauxEurChf;
      let contribAllocEURArr = contribAllocEUR.toFixed(2);
      let fraisAdmCHF = 0.002 * salaireBrutCHF;
      let fraisAdmCHFArr = fraisAdmCHF.toFixed(2);
      let fraisAdmEUR = fraisAdmCHF/tauxEurChf;
      let fraisAdmEURArr = fraisAdmEUR.toFixed(2);
      let pourcAffacturage = 0.023;

      let salaireAnnuel = salaireBrutCHF * 10.2;
      let salaireAnnuelArr = salaireAnnuel.toFixed(4);
      let salaireRef = salaireAnnuel - 25095;
      let salaireRefArr = salaireRef.toFixed(2);
      let lppPourcent = calculLPP(age);
      let lpp = salaireRef * lppPourcent / 12;
      let lppArr = lpp.toFixed(7);
      let ratio = salaireTotalEUR/caEUR;
      let ratioArr = ratio.toFixed(4);

      let coutEmployeurCHF = cotAvsCHF + cotAcCHF + cotMaterniteCHF + cotIjmCHF + cotAapCHF + cotLaacCHF + contribEnfCHF + contribAllocCHF + fraisAdmCHF + lpp;
      let coutEmployeurCHFArr = coutEmployeurCHF.toFixed(2);
      let coutEmployeurEUR = coutEmployeurCHF/tauxEurChf;
      let coutEmployeurEURArr = coutEmployeurEUR.toFixed(2);
      let margePotCHF = caCHF - salaireBrutCHF - totalFraisCHF - coutEmployeurCHF;
      let margePotCHFArr = margePotCHF.toFixed(2);
      let margePotEUR = margePotCHF/tauxEurChf;
      let margePotEURArr = margePotEUR.toFixed(2);
      let margePotPourcent = margePotEUR/caEUR;
      let margePotPourcentArr = margePotPourcent.toFixed(4);
      let margeAnnuelle = margePotEUR * 10.8;
      let margeAnnuelleArr = margeAnnuelle.toFixed(2);
      let margePotAffacturage = margePotEUR - (pourcAffacturage * caEUR);
      let margePotAffacturageArr = margePotAffacturage.toFixed(2);
      let margePotPourcent2 = margePotAffacturage/caEUR;
      let margePotPourcent2Arr = margePotPourcent2.toFixed(4);

      document.getElementById('wf-form-Simu').style.display='none';
      document.getElementById('invoice').style.display="block";
      

      /* Affichage partie consultant */
      document.getElementById('nom-prenom-aff').innerHTML = nomPrenom;
      document.getElementById('tjm-aff').innerHTML = tjmEUR;

      document.getElementById('ca-eur').innerHTML = caEURArr;
      document.getElementById('ca-chf').innerHTML = caCHFArr;

      document.getElementById('salaire-brut-eur').innerHTML = salaireBrutEURArr;
      document.getElementById('salaire-brut-chf').innerHTML = salaireBrutCHFArr;
      
      document.getElementById('impot-eur').innerHTML = retImpotEURArr;
      document.getElementById('impot-chf').innerHTML = retImpotCHFArr;
      
      document.getElementById('frais-repas-eur').innerHTML = fraisRepasEURArr;
      document.getElementById('frais-repas-chf').innerHTML = fraisRepasCHFArr;
      
      document.getElementById('salaire-net-eur').innerHTML = salaireTotalEURArr;
      document.getElementById('salaire-net-chf').innerHTML = salaireTotalCHFArr;
      
      document.getElementById('ratio').innerHTML = (ratioArr*100).toFixed(2) + "%";
      
      document.getElementById('taux-eur-chf-aff').innerHTML = tauxEurChf;

      /** Affichage partie interne */

      document.getElementById('nom-prenom-aff-2').innerHTML = nomPrenom;
      document.getElementById('age-aff').innerHTML = age;
      document.getElementById('tjm-aff-2').innerHTML = tjmEUR;
      document.getElementById('nb-jours-aff').innerHTML = nbJours;
      document.getElementById('distance-aff').innerHTML = distance;
      document.getElementById('categorie-aff-2').innerHTML = categorie;
      document.getElementById('taux-garden-aff').innerHTML = tauxGardenIT;
      document.getElementById('taux-eur-chf-aff-2').innerHTML = tauxEurChf;
  }

  function calculLPP(age){
      if(age>=0 && age<=24){return 0.00;}
      if(age>=25 && age<=34){return 0.07;}
      if(age>=35 && age<=44){return 0.10;}
      if(age>=45 && age<=54){return 0.15;}
      if(age>=55 && age<=65){return 0.18;}           
  }

  // DATA pour taux d'impot

  function searchTauxImpot(salaire,categorie){
      const obj  = JSON.parse(data);
      
      for (let i = 0; i < data.length; i++){
          if ((salaire >= obj[i].salaireINF) && (salaire <= obj[i].salaireSUP)){
              if(categorie=="A0"){
                  return obj[i].A0;
              }
              if(categorie=="B0"){
                  return obj[i].B0;
              }
              if(categorie=="B1"){
                  return obj[i].B1;
              }
              if(categorie=="B2"){
                  return obj[i].B2;
              }
              if(categorie=="B3"){
                  return obj[i].B3;
              }
              if(categorie=="B4"){
                  return obj[i].B4;
              }
              if(categorie=="B5"){
                  return obj[i].B5;
              }
              if(categorie=="C0"){
                  return obj[i].C0;
              }
              if(categorie=="C1"){
                  return obj[i].C1;
              }
              if(categorie=="C2"){
                  return obj[i].C2;
              }
              if(categorie=="C3"){
                  return obj[i].C3;
              }
              if(categorie=="C4"){
                  return obj[i].C4;
              }
              if(categorie=="C5"){
                  return obj[i].C5;
              }
              if(categorie=="H1"){
                  return obj[i].H1;
              }
              if(categorie=="H2"){
                  return obj[i].H2;
              }
              if(categorie=="H3"){
                  return obj[i].H3;
              }
              if(categorie=="H4"){
                  return obj[i].H4;
              }
              if(categorie=="H5"){
                  return obj[i].H5;
              }
              else{
                  return "error";
              }
          }
      } 
      
  }
</script>
</body>
</html>
